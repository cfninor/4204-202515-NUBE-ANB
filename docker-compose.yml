services:
  postgres:
    image: postgres:16-alpine
    container_name: pg-anb
    environment:
      POSTGRES_DB: anbdb
      POSTGRES_USER: anbuser
      POSTGRES_PASSWORD: anbpass
    volumes: [ ".pgdata:/var/lib/postgresql/data" ]
    ports: [ "5434:5432" ]

  pgbouncer:
    image: edoburu/pgbouncer:latest
    container_name: pgbouncer-anb
    environment:
      DB_USER: anbuser
      DB_PASSWORD: anbpass
      DB_HOST: postgres
      DB_NAME: anbdb
      POOL_MODE: transaction
      MAX_CLIENT_CONN: 2000
      DEFAULT_POOL_SIZE: 50
    depends_on: [ postgres ]
    ports: [ "6432:6432" ] 

  rabbitmq:
    image: rabbitmq:3.13-management-alpine
    container_name: rabbitmq-anb
    ports: [ "5672:5672", "15672:15672" ]

  redis:
    image: redis:7-alpine
    container_name: redis-anb
    ports: [ "6379:6379" ]
